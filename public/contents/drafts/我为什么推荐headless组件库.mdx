---
title: "我为什么推荐headless组件库"
slug: "why-I-prefer-headless-components"
published: true
createdAt: "2024-05-08"
updatedAt: "2024-05-08"
category: "tech"
tags: ["组件库"]
cover: 'https://s3-yume.s3.ap-northeast-1.amazonaws.com/sky2.webp'
---

## 序

一些碎碎念，突然想起来就写了

## 起因

最近在公司里开发 angular16 的项目时，mentor 把原来基于 scoped 的样式重构了一下，类似于 tailwind 的原子化形式，variable 存 less 变量，公共 class 逻辑上分成分成 base 级和 component 级，都引入全局 css 里。那我就很疑惑啊，既然都这么做了，为啥不直接上原子化框架，他把该封装的 base 类都封好了，改写配置文件就可以很 easy 的完成整个重构，为什么要自己写一份呢？mentor 表示这样会更方便跨平台的迁移，还有后续更新上，还是很有道理的。（我的评价是不如 tailwind，直接写的就是 scoped，用 class 的就是公有的）

在重写的时候，自然去研究了一下原有的样式文件。维护的其实也很不错，样式都放在一个文件夹下，各司其职，也有部分全局配置，而最关键的则是对 antd 的整体覆盖重写的这个文件夹。可以说正是有了之前对 antd 的大规模重写，才让后续的组件样式代码写的不会过于折磨，直接用 antd 就可以了。当然也是会有一些样式 bug 问题存在的，比如期间遇到了 firefox 的 scroll 导致高度塌陷问题。毕竟自己重写不会像组件库一样考虑那么多。

而在项目的实际开发过程中，则是 antd 和自己封装类都在用。

## 传统组件库

组件库是一系列可重用的 UI 元素或功能模块的集合。用组件库最主要的目的，就是减少对基础交互的代码量。

针对不同业务，我们可能需要通过组件库暴露出来的 api 二次封装组件，定制符合特定业务的组件。

针对系统 UI，我们可能需要通过覆盖组件库的默认样式，定制符合设计稿的组件。

而这两者几乎是我们在开发静态页面时的全部。而其中样式的兼容更是重量级，因为组件库的样式并不由我们控制，只能在控制台找到对应的样式然后覆盖，或者改一些源码（应该没有这样做的吧）

## 经过

而在公司业务的开发过程中，其实也有遇到过一些有趣的事件。

有一个 select 展示数据不全的 bug，提出 bug 的测试希望从根源上解决这个问题。

有一个大佬表示：

对于展示，大家肯定都希望能展示全。可是，这些列表字段有的很长，如果都显示那肯定是很乱，反而不利于用户理解这里面的关系。

例如，我一共选择了哪些？如果用户的分辨率过低，无论如何也显示不下又该怎么办？如果我们为了展现完整，无非就是增大文字呈现区域，按 UI 规范，交互无非就是下拉，侧边抽屉这种。仍然会有此现象。如果我们切换页面，对用户查阅当前信息来说，交互行为又割裂了，需要切来切去，始终无法一个画面内完成上下文相关的信息阅读。

我们把输入框改长一些，也都有可能遇到超出弹窗或抽屉内下拉框所允许的宽度边界。那么又会出现不同的弹窗，宽度不一致，有割裂感。同时，该交互又要展现支持多选，以及用户选择了多少个其他选项这种关系。所以，无论如何都存在一定的限制，没有完美方案。

最后这个 bug 也仅仅是针对特例的修复。

后来我发现，针对设计稿里的一些比较难做的样式，很多都会向前端兼容——改成 antd 类似的样式，毕竟只是后台，antd 也足够美观了。

同时，由于使用了微前端，为了跨微应用的组件共享，我们也有自研组件库，部分作为对 antd 的简单补充。

但就是在这样妥协的情况下，开发过程中还是会改到一些应该扩散、不该用硬编码的样式。这个时候问题就来了：要不要考虑重用？它的扩散范围在哪？同时，antd + 定制类的编写方式也比较割裂，在迁移过程中，我花了很多额外时间在理解已经封装好的类上。同时由于这是一个迁移过程，难免在不同的微应用中，样式完全就是两个形态。改 bug 的体验也不好。

## headless 组件库

此前，我也在某些博客上看到对 shadcn 的盛赞，2023 Rising Stars 的榜首也是它。为什么它如此受欢迎？在我的视角里，最核心的一点就是，它解决了使用组件库时样式的痛点：编写时痛苦的覆盖，重用时混乱的管理。

无头组件库通过解耦结构与样式，只提供结构和交互的逻辑，至于样式？自己写去吧！自己从头开始写可比覆盖简单多了，而且写出来的内容就是自己的定制类，在之后的重用中也是用的自己的内容。就像是「穿衣服」一样，切图仔拿到 UI 那边的衣服，再给组件们统统穿上，到最后组件穿的都是自己家的衣服。而自己的东西最大的好处就是可控。微调、升级、重用变得非常简单。

继续聊聊 shadcn，使用它的感受就很奇妙，像是直接把组件库的源码给到我，结合 tailwind 写下来，就像是我在创建自己的组件库一样：tailwind 提供定制化的架子，shadcn 给我实体。

同时它还有跨平台、浏览器兼容性、无障碍访问等优点。

## 最后

强烈建议大家可以尝试一下。vue 的话可以使用 headless UI，体验也很不错。

突然想起来之前用antd + tailwind写项目的时候遇到过样式优先级的bug，当时还重写了某些配置。而这个项目一开始时间充足的时候，我天真的想着tailwind一把梭，也自己手撕了一些组件。“还是自己写的安心”，这样的感觉。后面嫌麻烦还是antd一把梭了。